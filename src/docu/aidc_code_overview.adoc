= Aktueller Codezustand (AIDC)
:toc:
:toclevels: 3

Kurzer, klickbarer Überblick über Struktur und Funktionen des Projekts (Backend, Frontend, Container). Alle Links zeigen auf die aktuelle Codebasis.

== Struktur
* Backend (Express + Prisma): link:../../src/backend[index.js, Prisma-Setup]
* Frontend (React + Supabase): link:../../src/frontend/src[React-App mit Auth und Habits-UI]
* Container/Dev: link:../../src/docker-compose.yml[docker-compose], link:../../src/Dockerfile.dev[Dockerfile]

== Backend (Express + Prisma)
=== link:../../src/backend/index.js[index.js]
- Init: Express, CORS, JSON-Parsing; Prisma-Client-Import.
- `GET /` liefert kurzen Hello-Text.
- `GET /api/hello` liefert JSON `{ msg }`.
- `GET /api/habits` holt alle `habits_table`-Zeilen, wandelt BigInt-Felder in Strings und liefert JSON.
- Serverstart auf `PORT` (Default 5000) und `0.0.0.0`.

=== Prisma
* link:../../src/backend/src/prisma.js[src/prisma.js] – erstellt `PrismaClient` mit Log-Ausgaben und exportiert Instanz.
* link:../../src/backend/prisma/schema.prisma[prisma/schema.prisma] – Modelle:
** `habits_table` mit Feldern wie `habit_name`, `description`, `start_date`, `streak`, `last_checked`, `prev_last_checked`, `user_id`.
** `users` Modell mit Basisfeldern (id, created_at, name, streak_duration, streak_freezes, food_points, recovery_on).
* link:../../src/backend/prisma.config.js[prisma.config.js] – Prisma-Konfiguration (Schema-Pfad, Migrationspfad, Engine „classic“, Datasource aus `DATABASE_URL`).
* link:../../src/backend/.env[.env] – `DATABASE_URL` (Supabase-Postgres).
* link:../../src/backend/package.json[package.json] – Skripte: `dev` (nodemon), `start` (node), `prisma:generate`.

== Frontend (React + Supabase)
=== App und Auth
* link:../../src/frontend/src/App.jsx[App.jsx] – Lädt Supabase-Session, Login/Registrierung/Logout; zeigt Login-Form oder `HabitsPage` nach Auth.
* link:../../src/frontend/src/supabaseClient.js[supabaseClient.js] – erstellt Supabase-Client aus `REACT_APP_SUPABASE_URL`/`REACT_APP_SUPABASE_ANON_KEY`.
* link:../../src/frontend/src/api/authApi.js[api/authApi.js] – Auth-Funktionen: `getSession`, `onAuthStateChange`, `login`, `register`, `logout`.

=== Habits-API-Layer
* link:../../src/frontend/src/api/habitsApi.js[api/habitsApi.js]
** `fetchHabits(userId)` – liest Habits des Users, sortiert nach Startdatum.
** `addHabit({ userId, name, desc })` – legt Habit mit heutigem Startdatum an.
** `deleteHabit({ userId, id })` – löscht Habit des Users.
** `toggleHabitToday({ habitId, userId })` – holt Habit, prüft ob heute erledigt; setzt/entfernt `last_checked`, pflegt `prev_last_checked`, passt `streak` an und gibt aktualisierte Zeile zurück.

=== Seiten & Komponenten
* link:../../src/frontend/src/pages/HabitsPage.jsx[HabitsPage.jsx] – lädt Habits, delegiert Add/Delete/Check an API, rendert Navbar, HabitForm, HabitGrid, Calender.
* link:../../src/frontend/src/components/HabitForm.jsx[HabitForm.jsx] – Formular zum Anlegen (Name, Beschreibung), ruft `onAdd`.
* link:../../src/frontend/src/components/HabitGrid.jsx[HabitGrid.jsx] – trennt Habits in „heute erledigt“ vs. „offen“, rendert `HabitCard`s.
* link:../../src/frontend/src/components/HabitCard.jsx[HabitCard.jsx] – zeigt Habit-Daten, Löschen-Button, Toggle-Switch für „heute erledigt“.
* link:../../src/frontend/src/components/Calender.jsx[Calender.jsx] – Monatsmatrix, Fortschrittsanzeige pro Tag (Kreis/Progress), Navigation Monate, Heutestatus.
* link:../../src/frontend/src/components/Navbar.jsx[Navbar.jsx] – einfache Hash-Navigation (Übersicht/Hinzufügen) und Logout-Button.
* link:../../src/frontend/src/components/HabitList.jsx[HabitList.jsx] – ältere Demo-Snippets für Habits-Render/Check (nicht im Flow genutzt).

=== Utilities & Styles
* link:../../src/frontend/src/lib/convert.js[lib/convert.js] – `dateOnly(ts)`, `monthAndYear(y,m)`, `todayAsString()`.
* link:../../src/frontend/src/lib/calendar.js[lib/calendar.js] – `getMonthMatrix` (Kalendergrid, Mo-Start), `isEveryHabitChecked` (true oder %-Wert pro Tag).
* link:../../src/frontend/src/App.css[App.css], link:../../src/frontend/src/index.css[index.css] – Styles; Bootstrap 5 eingebunden; Tailwind konfiguriert in link:../../src/frontend/tailwind.config.js[tailwind.config.js] (aktuell minimal genutzt).

== Container/Dev
* link:../../src/docker-compose.yml[docker-compose.yml] – Services `backend` (npm install → prisma:generate → dev/start, Port 3001) und `frontend` (npm install → dev/start, Ports 5173/3000); `backend` lädt `backend/.env`.
* link:../../src/Dockerfile.dev[Dockerfile.dev] – Basis für beide Services (Node + Arbeitsverzeichnis `/app`).
